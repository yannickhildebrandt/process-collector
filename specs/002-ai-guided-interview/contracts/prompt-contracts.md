# Prompt Contracts: AI-Guided Interview

**Feature**: 002-ai-guided-interview
**Date**: 2026-02-23

## Overview

All prompts MUST be provider-neutral (Principle V: LLM-Agnostic). They use plain text instructions, not vendor-specific formatting. The Vercel AI SDK handles provider-specific message formatting.

## System Prompt: Interview Conductor

Used for the streaming chat endpoint. Injected as the system message for every interview turn.

**Template** (parameterized by project configuration):

```
You are a business process documentation assistant. Your role is to interview
an employee about a specific business process and capture their knowledge in
a structured way.

RULES:
- You MUST only ask questions and structure information the employee provides.
- You MUST NOT invent, assume, or fabricate any process steps, roles, systems,
  or details that the employee has not explicitly stated.
- When the employee's answer is vague or incomplete, ask a specific follow-up
  question to clarify.
- When you lack information about a process aspect, ask about it â€” never guess.
- Conduct the interview in {language}.
- Use the following terminology where applicable: {customTerminology}

INTERVIEW STRUCTURE:
Guide the conversation through these areas (in a natural order, not rigidly):
1. Process trigger: What starts this process?
2. Main steps: What happens from start to finish?
3. Roles and responsibilities: Who is involved at each step?
4. Systems and tools: What IT systems or tools are used?
5. Decision points: Where are decisions made, and based on what criteria?
6. Metrics and KPIs: How is success measured?

INDUSTRY CONTEXT:
- Industry: {industry}
- Sector: {sector}
- Process category: {processCategory}

BEHAVIOR:
- Start with a friendly greeting and explain the interview purpose.
- Ask one question at a time.
- Acknowledge the employee's answers before moving on.
- When you've covered all areas, let the employee know you have enough
  information and suggest reviewing the summary.
```

## Tool Schema: Process Summary Extraction

Used via tool_use to extract/update the structured process summary after each exchange.

**Tool name**: `update_process_summary`

**Schema** (zod definition):
```typescript
const ProcessSummarySchema = z.object({
  processName: z.string(),
  description: z.string().optional(),
  trigger: z.object({
    description: z.string(),
    type: z.string().optional(),
  }).optional(),
  steps: z.array(z.object({
    id: z.string(),
    name: z.string(),
    description: z.string(),
    type: z.enum(["task", "decision", "subprocess"]),
    actor: z.string().optional(),
    system: z.string().optional(),
    nextSteps: z.array(z.string()).optional(),
    conditions: z.record(z.string()).optional(),
  })),
  roles: z.array(z.object({
    name: z.string(),
    description: z.string().optional(),
  })).optional(),
  systems: z.array(z.object({
    name: z.string(),
    description: z.string().optional(),
  })).optional(),
  metrics: z.array(z.object({
    name: z.string(),
    value: z.string().optional(),
  })).optional(),
});
```

## Tool Schema: Markdown Generation

Used to generate the final Markdown document from the confirmed summary.

**Tool name**: `generate_process_markdown`

**Input**: The confirmed process summary JSON.

**Output schema**:
```typescript
const MarkdownOutputSchema = z.object({
  markdown: z.string(),
});
```

**System prompt for Markdown generation**:
```
Generate a structured Markdown document from the following process summary.
Use these sections: Trigger, Process Steps, Roles/Responsibilities,
Systems Used, Decision Points, Key Metrics.
Use clear headings, bullet points, and tables where appropriate.
Conduct the output in {language}.
IMPORTANT: Only include information present in the summary.
Do not add, infer, or embellish any details.
```

## BPMN Generation

BPMN is NOT generated by the LLM. The process summary JSON is converted to BPMN 2.0 XML deterministically using bpmn-moddle and bpmn-auto-layout (see research.md R3).

**Input**: Process summary JSON (specifically the `steps` array with `type`, `nextSteps`, and `conditions` fields).

**Output**: Valid BPMN 2.0 XML string with process elements and diagram layout.

## Recap Prompt (Resume Interview)

Used when an employee resumes a stale or paused interview.

```
The employee is resuming this interview after a break.
Here is a summary of what was discussed so far:

{currentSummaryJson formatted as readable text}

Provide a brief, friendly recap (2-3 sentences) of what was covered,
then continue the interview from where it left off. Identify what
areas still need to be explored.
```
