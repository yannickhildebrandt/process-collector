# Implementation Plan: Brand Design Polish

**Branch**: `005-brand-design-polish` | **Date**: 2026-02-24 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/005-brand-design-polish/spec.md`

## Summary

Apply Eggers & Partner brand identity (cyan-blue accent #0693e3, dark charcoal text, pill-shaped buttons) across the application via CSS theme token changes and targeted component updates. Fix BPMN diagram regeneration to always use current summary content with proper error/loading UX. No database changes needed.

## Technical Context

**Language/Version**: TypeScript 5.x, Node.js 22+
**Primary Dependencies**: Next.js 16, React 19, Tailwind CSS v4, shadcn/ui, bpmn-js 18
**Storage**: N/A (no database changes)
**Testing**: Manual viewport and visual testing per quickstart.md
**Target Platform**: Browser-based web application (responsive, 320px–1920px)
**Project Type**: Web application (Next.js App Router)
**Performance Goals**: BPMN diagram generation < 5 seconds (already instant, synchronous function)
**Constraints**: WCAG AA contrast compliance (4.5:1 normal text, 3:1 large text/UI)
**Scale/Scope**: ~10 pages affected by theme changes, 2 component files modified

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Notes |
|-----------|--------|-------|
| I. AI-Guided, Not AI-Replaced | PASS | No AI behavior changes. BPMN diagram is generated from user-provided interview data. |
| II. Self-Service by Design | PASS | Improves UX: clearer brand identity, better visual feedback on diagram generation. |
| III. Structured Output over Free Text | PASS | BPMN regeneration ensures diagram always reflects current structured summary. |
| IV. Configuration as Data, Not Code | PASS | Colors are theme tokens (CSS variables), not hardcoded per-component. |
| V. LLM-Agnostic by Architecture | PASS | No LLM changes. Pure frontend/styling changes. |

**Post-design re-check**: All gates still PASS. No violations.

## Project Structure

### Documentation (this feature)

```text
specs/005-brand-design-polish/
├── plan.md              # This file
├── research.md          # Color mapping, button radius, typography decisions
├── data-model.md        # Theme token change table (no DB changes)
├── quickstart.md        # Setup + testing checklist
├── checklists/
│   └── requirements.md  # Spec quality checklist
└── tasks.md             # Task breakdown (generated by /speckit.tasks)
```

### Source Code (files affected)

```text
src/
├── app/
│   └── globals.css                          # Theme tokens (colors, radius)
├── components/
│   ├── interview/
│   │   └── summary-panel.tsx                # BPMN regeneration UX improvements
│   └── ui/
│       └── button.tsx                       # Pill-shaped border-radius for primary/destructive
└── i18n/
    └── messages/
        ├── en.json                          # New i18n keys for diagram UX
        └── de.json                          # German translations
```

**Structure Decision**: Existing Next.js App Router structure. Changes are limited to theme tokens in `globals.css`, one component file (`summary-panel.tsx`), one UI primitive (`button.tsx`), and i18n files.

## Implementation Details

### US1: BPMN Diagram Regeneration

**Current state**: `handleGenerateBpmn()` in `summary-panel.tsx` reads from the `summary` prop directly (line 48-50). The function is synchronous — `generateBpmnXml(summary)` returns instantly. Each button click already gets the latest summary value.

**Changes needed**:
1. **Button always visible when summary has steps** — already the case (line 209-213)
2. **Button disabled when no summary exists** — need to add `disabled` prop when `!summary?.steps?.length`
3. **Error state display** — currently errors silently set `bpmnXml` to null. Add error state variable and show error message in UI with retry option.
4. **Button text changes after first generation** — differentiate "Generate Diagram" vs "Regenerate Diagram" to make it clear the user can click again after summary updates

### US2: Brand Color Scheme

**Approach**: Update CSS custom properties in `globals.css` — affects all shadcn/ui components automatically.

**Light mode changes** (`:root`):
- `--primary`: `oklch(0.205 0 0)` → `oklch(0.623 0.173 245.28)` (cyan-blue #0693e3)
- `--primary-foreground`: keep `oklch(0.985 0 0)` → `oklch(1 0 0)` (white)
- `--ring`: `oklch(0.708 0 0)` → `oklch(0.623 0.173 245.28)` (cyan-blue focus rings)

**Dark mode changes** (`.dark`):
- `--primary`: `oklch(0.922 0 0)` → `oklch(0.68 0.173 245.28)` (lighter cyan-blue)
- `--primary-foreground`: keep `oklch(0.205 0 0)` → `oklch(1 0 0)` (white on blue)
- `--ring`: `oklch(0.556 0 0)` → `oklch(0.68 0.173 245.28)` (cyan-blue)

**WCAG AA verification**:
- Cyan-blue (#0693e3) on white: contrast ~4.6:1 — passes AA for normal text
- White on cyan-blue: contrast ~4.6:1 — passes AA for button text
- Lighter cyan-blue on dark bg (#212121): contrast ~5.2:1 — passes AA

### US2 (continued): Button Pill Shape

**Approach**: In `button.tsx`, change `rounded-md` to `rounded-full` for `default` and `destructive` variants. Keep `rounded-md` for outline, ghost, secondary, and link variants.

**Implementation**: Replace the base `rounded-md` in the CVA config with variant-specific radius classes.

### US3: Typography and Spacing

**Approach**: Keep Geist font (already clean/professional). Minor adjustments if needed to heading weights or letter spacing via globals.css. The current typography is already professional; the main impact comes from the color changes in US2.

## Complexity Tracking

No constitution violations. No complexity tracking entries needed.
